<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Sql | 黃金俠]]></title>
  <link href="http://rubyist.marsz.tw/blog/categories/sql/atom.xml" rel="self"/>
  <link href="http://rubyist.marsz.tw/"/>
  <updated>2012-01-17T23:22:42+08:00</updated>
  <id>http://rubyist.marsz.tw/</id>
  <author>
    <name><![CDATA[MarsZ]]></name>
    <email><![CDATA[marsz330@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[如何在 datetime 的欄位中做日期的搜尋]]></title>
    <link href="http://rubyist.marsz.tw/blog/2012-01-04/query-datetime-by-date/"/>
    <updated>2012-01-04T16:54:00+08:00</updated>
    <id>http://rubyist.marsz.tw/blog/2012-01-04/query-datetime-by-date</id>
    <content type="html"><![CDATA[<p>rails 在儲存 datetime 時,會先去除時區,然後才把 +0 的原始時間存到資料庫中
因此若我們直接下 sql 時, 必須將時區考量進去</p>

<!-- more -->


<p>例如我們想要找欄位 created_at 在 2012-01-01 00:00:00 到 2012-01-03 23:59:59 的資料
以台灣 +8 時區為例, 我們應該找資料庫中 2011-12-31 16:00:00 到 2012-01-03 15:59:59 的資料
以下範例可直接達到所想要的 sql</p>

<p><code>ruby
date_start = "2012-01-01"
date_end = "2012-01-03"
range = date_start.to_date.beginning_of_day..date_end.to_date.end_of_day
User.where(:created_at =&gt; range)
</code></p>

<p><a href="http://api.rubyonrails.org/classes/Date.html" target="_blank">Date</a>中有 "beginning_of_day" 和 "end_of_day" 兩個 method 將 Date 轉換為 Datetime 並且使時間落在當天的開始與結束, 透過 ActiveRecord 以 hash 方式作為 query interface, 時區才會自動轉換</p>

<p>同樣在 Date 中還有 beginning_of_month, beginning_of_quarter, beginning_of_week, beginning_of_year 可用</p>

<h6>補充</h6>

<p>有關時區設定可參考 config/application.rb</p>
]]></content>
  </entry>
  
</feed>
